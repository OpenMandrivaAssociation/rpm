From ab83506f68c57e68745c4e857ae03d9533b49360 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Bernhard=20Rosenkr=C3=A4nzer?= <bero@lindev.ch>
Date: Mon, 10 Nov 2025 04:12:29 +0100
Subject: [PATCH] Add a preliminary pgpDigParamsSalt implementation

---
 rpmpgp_internal_api.c | 28 ++++++++++++++++++++++++++++
 1 file changed, 28 insertions(+)

diff --git a/rpmpgp_internal_api.c b/rpmpgp_internal_api.c
index 8619915..7fd6cdd 100644
--- a/rpmpgp_internal_api.c
+++ b/rpmpgp_internal_api.c
@@ -278,3 +278,31 @@ rpmRC pgpPubkeyMerge(const uint8_t *pkts1, size_t pkts1len, const uint8_t *pkts2
     return rc == RPMPGP_OK ? RPMRC_OK : RPMRC_FAIL;
 }
 
+int pgpDigParamsSalt(pgpDigParams digp, const uint8_t **datap, size_t *lenp)
+{
+    if(!digp || !datap || !lenp) {
+        fprintf(stderr, "pgpDigParamsSalt: Bad parameters\n");
+        return -1;
+    }
+
+    *datap = NULL;
+    *lenp = 0;
+
+    if(digp->tag != PGPTAG_SIGNATURE) {
+        fprintf(stderr, "pgpDigParamsSalt: not a signature\n");
+        return -1;
+    }
+    if(digp->sigtype != PGPSIGTYPE_BINARY) {
+        fprintf(stderr, "pgpDigParamsSalt: not a binary signature\n");
+        return -1;
+    }
+    if(digp->hash_algo != RPM_HASH_SHA256) {
+        fprintf(stderr, "pgpDigParamsSalt: non-SHA256 signature detected (%u), this may or may not work\n", digp->hash_algo);
+    }
+
+    // digp->hash contains a signature with length digp->hashlen
+    // but as of 6.0.0, there is no indication of it being salted,
+    // so returning an empty salt seems to be the right thing to
+    // do unconditionally
+    return 0;
+}
